(function(){function e(e){return e=encodeURI(e),document.getElementById(e).querySelector(".leancloud-visitors-count")}function o(o){const t=document.querySelector(".leancloud_visitors"),n=decodeURI(t.id),r=t.dataset.flagTitle;o("get","/classes/Counter?where="+encodeURIComponent(JSON.stringify({url:n}))).then(e=>e.json()).then(({results:t})=>{if(t.length>0){const r=t[0];e(n).innerText=r.time+1,o("put","/classes/Counter/"+r.objectId,{time:{__op:"Increment",amount:1}}).catch(e=>{console.error("Failed to save visitor count",e)})}else o("post","/classes/Counter",{title:r,url:n,time:1}).then(e=>e.json()).then(()=>{e(n).innerText=1}).catch(e=>{console.error("Failed to create",e)})}).catch(e=>{console.error("LeanCloud Counter Error",e)})}function t(o){const t=document.querySelectorAll(".leancloud_visitors"),n=[...t].map(e=>decodeURI(e.id));o("get","/classes/Counter?where="+encodeURIComponent(JSON.stringify({url:{$in:n}}))).then(e=>e.json()).then(({results:o})=>{for(let t of n){const n=o.find(e=>e.url===t);e(t).innerText=n?n.time:0}}).catch(e=>{console.error("LeanCloud Counter Error",e)})}function n(e){const n=(o,t,n)=>fetch(`${e}/1.1${t}`,{method:o,headers:{"X-LC-Id":r,"X-LC-Key":s,"Content-Type":"application/json"},body:JSON.stringify(n)});mashiro_option.isPost?o(n):document.querySelectorAll(".leancloud_visitors").length>=1&&t(n)}const{app_id:r,app_key:s,server_url:i}={enable:mashiro_option.leancloud_visitors.enable,app_id:mashiro_option.leancloud_visitors.app_id,app_key:mashiro_option.leancloud_visitors.app_key,server_url:mashiro_option.leancloud_visitors.server_url,security:!1},l="-MdYXbMMI"===r.slice(-9)?`https://${r.slice(0,8).toLowerCase()}.api.lncldglobal.com`:i;l?n(l):fetch("https://app-router.leancloud.cn/2/route?appId="+r).then(e=>e.json()).then(({api_server:e})=>{n("https://"+e)})})();